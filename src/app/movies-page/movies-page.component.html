<ng-template #castTemplate let-cast="cast">

  <div fxLayout="row wrap" fxLayoutGap="10px" >

      <mat-card *ngFor="let person of cast; let i=index" class="person-card" >
          <img mat-card-image [src]="person.profile_path" [alt]="person.name">
          <mat-card-header>
            <mat-card-title class="person-trauncate">{{person.name}}</mat-card-title>
            <mat-card-subtitle class="person-trauncate">{{person.character}}</mat-card-subtitle>
          </mat-card-header>
      </mat-card>

  </div>
</ng-template>

<ng-template #singleMovieTemplate let-movie='data' let-cast="cast" let-topCast="topCast" let-displayedColumns='displayedColumns' let-tableData='tableData' let-isFetching='isFetching' >

  <div fxLayout="row wrap" fxFlexAlign="end" >
    
    <div fxFlex="50" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
      <mat-card *ngIf="!isFetching">
          <img mat-card-image [src]="movie.poster_path" style="object-fit: cover; height: 400px;" [alt]="movie.title">
          <mat-card-header style="position: relative; top:0px; width: 100%; height: 50px;" >
            <mat-card-title>{{movie.title}}</mat-card-title>
          </mat-card-header>
        
          <mat-card-content>
            <p [innerHtml]="movie.overview"></p>
          </mat-card-content>                              
          
      </mat-card>
    </div>


    <div fxFlex="50" fxFlex.md="50" fxFlex.sm="100" fxFlex.xs="100">
      <table mat-table [dataSource]="tableData" style="width: 100%;">

        <!--- Note that these columns can be defined in any order.
              The actual rendered columns are set as a property on the row definition"
    

        <ng-container [matColumnDef]="column" *ngFor="let column of displayedColumns">
          <th mat-header-cell *matHeaderCellDef> &nbsp; &nbsp; </th>
          

          <td mat-cell style="min-width:150px" *matCellDef="let element"> 
         </td>
          
        </ng-container>
 -->

          <!-- Position Column -->
          <ng-container matColumnDef="name">
              <th mat-header-cell *matHeaderCellDef>  </th>
              <td mat-cell *matCellDef="let element"> {{element.name}} </td>
            </ng-container>
          
            <!-- Name Column -->
            <ng-container matColumnDef="value">
              <th mat-header-cell *matHeaderCellDef>  </th>
              <td mat-cell *matCellDef="let element"> 

                  

                <ng-container [ngSwitch]="element.name">

                    <ng-container *ngSwitchCase="'HOMEPAGE'">
                        <a *ngIf="element.value" [href]="element.value" target="_blank">{{element.value}}</a>
                    </ng-container>

                    <ng-container *ngSwitchCase="'REVENUE'">
                         {{element.value |  currency:'USD' }}
                    </ng-container>

                    <ng-container *ngSwitchCase="'POPULARITY'">
                      <button mat-fab color="primary">{{element.value}}</button>
                      <mat-progress-bar mode="determinate" [value]="element.value"></mat-progress-bar>
                    </ng-container>
      
                    <ng-container *ngSwitchDefault>
                        {{element.value}}  
                    </ng-container>
                      
                </ng-container>                
              </td>
            </ng-container>


          
 

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      
      </table>
    </div>
      
  </div>

  <div>
    <mat-tab-group>
      <mat-tab label="Top Cast">
          <ng-template [ngTemplateOutlet]="castTemplate" [ngTemplateOutletContext]="{cast: topCast}"></ng-template> 

      </mat-tab>
      <mat-tab label="Full Cast">
          <ng-template [ngTemplateOutlet]="castTemplate" [ngTemplateOutletContext]="{cast: cast}"></ng-template> 

      </mat-tab>
      <mat-tab label="Crew"> Content 3 </mat-tab>
      <mat-tab label="Video"> Content 1 </mat-tab>
    </mat-tab-group>
  </div>

  <div fxLayout="row" fxLayoutAlign="center center" style="height:100px;" >
        <mat-spinner diameter="50" *ngIf="isFetching"></mat-spinner>
  </div>
</ng-template>



<ng-container *ngIf="movie_id; else MoviesTemplate">

    <app-movie [movie_id]="movie_id" #getMovie>
        <ng-template [ngTemplateOutlet]="singleMovieTemplate" [ngTemplateOutletContext]="getMovie"></ng-template> 
  
    </app-movie>

</ng-container>

<!-- shows  -->
<ng-template #MoviesTemplate>
    <app-movies [genre]="genre" fake="true" #movies>
            <mat-toolbar color="ascent">
                    <span>Fresh Tomato</span>
                    <app-genres #genres>
                        <a *ngFor="let genre of genres.data" [routerLink]="[ '/movies', 'genre', genre.id ]"  routerLinkActive="active" mat-button>
                            {{genre.name}}
                        </a>
                    </app-genres>
            </mat-toolbar>

            <div fxLayout="row wrap" fxLayoutGap="10px" fxFlexAlign="end">

                    <div *ngFor="let movie of movies.data" fxFlex="25" fxFlex.md="33" fxFlex.sm="50" fxFlex.xs="100" fxLayout="column" style="padding: 5px;" >
                      <mat-card color="primary" [routerLink]="[ '/movies', movie.id ]" >
                          <img mat-card-image [src]="movie.poster_path" style="object-fit: cover; height: 400px;" [alt]="movie.title">
                          <mat-card-header style="position: relative; top:0px; width: 100%; height: 50px;" >
                            <mat-card-title>{{movie.title}}</mat-card-title>
                          </mat-card-header>
                          <!-- 
                          <mat-card-content>
                            <p [ngStyle]="{ 'max-height': 'calc(1.4rem * 3)', 'overflow': 'hidden'}" [innerHtml]="movie.overview"></p>
                          </mat-card-content>                              
                          -->
                      </mat-card> 
                    </div>
                  
                  </div>

        <div fxLayout="row" fxLayoutAlign="center center" style="height:100px;" >
            <button mat-raised-button *ngIf="!movies.isFetching" color="primary" (click)="movies.fetchMovies()">More</button>
            <mat-spinner  diameter="50" *ngIf="movies.isFetching"></mat-spinner>
        </div>
        
    </app-movies>
</ng-template>



